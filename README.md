# Papicom Tape Convertor

## 何のソフトなの？

このプログラムは、PC-6001のプログラムのテープの音（ピーガガガってやつね）
を、PC-6001エミュレータ（PC6001V、iP6など）で使うP6フォーマットのテープ
イメージファイルに変換するツールです。
同様のツールとしてはP6DatRecなどがありますが、このプログラムはWindows以外
でも動作するのが特徴です。

## 動作条件

Java（バージョン1.5以降の実行環境）をインストールしたマシン
（Pure JavaなのでOSは問いません）

## 準備

PC-6001のプログラムのテープの音をWAVファイルに変換しておいてください。

※WAVファイルは以下の条件で作成する必要があります。
* モノラル（ステレオの場合は左チャネルの音声を処理します）
* サンプリング周波数11025Hz以上（サンプリング周波数が低いと、正しく処理
できない場合があります）


## 実行方法（Windows、MacOSXの場合）

1. 取得したPTC-X.X.X.jarをダブルクリックします。
PAPICOM TAPE CONVERTORのウインドウが開きます。

2. PAPICOM TAPE CONVERTORのウインドウにて、以下の設定が可能です。
    * スキップ時間：WAVファイルの最初に雑音が入っていて正しく読み取れない
    場合、最初からのスキップ時間を0〜1000秒の範囲で設定します。小数点以下の
    設定も可能です。
    * 極性反転：WAVファイルの波形の関係で正しく読み取れなかった場合にチェック
    すると、正しく読み取れるようになる場合があります。

3. ファイルメニューから「開く」を選び、変換対象のWAVファイルを指定します。

4. WAVファイルの変換処理が行われます。
処理が終わると「処理完了」のメッセージが表示されます。また、何らかの
エラーが発生した場合は、エラーメッセージのダイアログが開きます。

5. 同じディレクトリに、3.で指定したファイルと拡張子が異なる、以下の2つの
ファイルが生成されます。
    * 生成されるファイル
        * （3.で指定したファイル名の先頭部分）.P6 ：テープイメージファイル
        * （3.で指定したファイル名の先頭部分）.log：変換ログファイル
    * 注意
        *  4.で発生したエラーの種類によってはファイルは生成されません。
        * 既存のファイルが存在しても上書きされず、新しいファイル名で生成されます。

6. 終了する場合は、ウインドウを閉じる、またはファイルメニューから「終了」を
選びます。

## 実行方法（Windows、MacOS以外の場合、またはコマンドラインから実行する場合）

1. ターミナル（コマンドプロンプト）を開きます。

2. カレントディレクトリを、取得したPTC-X.X.X.jarのあるディレクトリに移動します。

3. 以下のコマンドを入力します。
`java -jar PTC-X.X.X.jar （コマンドラインオプション）`
    * X.X.Xの部分は取得したバージョンの値を指定してください。
    * コマンドラインオプションは以下の通りです。
        * -sXXXX 最初からのスキップ時間をXXXX秒に設定
        （0〜1000秒、小数の設定可能、デフォルト値は1.0秒）
        *  -n 極性反転モードをONにする（デフォルト値はOFF）
        * [ファイル名] 変換対象のWAVファイル
    * 注意
        * ファイル名を省略した場合は、PAPICOM TAPE CONVERTORのウインドウが
        開きます（以後の操作は前章参照）

4. WAVファイルの変換処理が行われます。
処理が終わると「処理完了」またはエラーメッセージが表示されます。

5. 同じディレクトリに、3.で指定したファイルと拡張子が異なる、以下の2つの
ファイルが生成されます。
    * 生成されるファイル
        * （3.で指定したファイル名の先頭部分）.P6 ：テープイメージファイル
        * （3.で指定したファイル名の先頭部分）.log：変換ログファイル
    * 注意
        *  4.で発生したエラーの種類によってはファイルは生成されません。
        * 既存のファイルが存在しても上書きされず、新しいファイル名で生成されます。

## 変換のロジック、ログについて
PC-6001のテープ出力はFSK方式であり、1200Hzと2400Hzの2種類の周波数で
ビットの0と1を表しています。

1バイトは、まず1200Hzのスタートビット（1ビット）を検知し、それに続く
8ビットを下位から取得することにより生成します。

このプログラムでは、WAVファイルの波形が下→上に移動する箇所の間隔から
1200Hzと2400Hz、すなわちビットの0と1を判断しています。

極性反転を指定した場合は、WAVファイルの波形が上→下に移動する箇所の
間隔からビットの0と1を判断します。

変換ログファイルには、WAVファイルの位置(10進)、P6ファイルのアドレス(16進)
・値(16進数)・判定結果が出力されます。

（例）

```
619303  -  13FE:2D (A)
↑　　　　　↑　↑　↑
位置　アドレス　値　判定結果
```

判定結果は、変換の精度が高い順から(A)(B)(C)(D)が出力されます。
もし、(C)や(D)が多数発生している場合の変換結果はかなり怪しいです。
なお、WAVファイルのサンプリング周波数が低いと正しく変換されていても
(C)が多数発生します。

## 高い精度で変換する方法
* テープから音声ファイルに取り込む時のサンプリング周波数は11kHz以上とする。
* 音声ファイルフォーマットの再変換時、サンプリング周波数とビット数の
変換は避ける。
* 判定結果(C)や(D)が多数発生している場合は極性反転を試してみる。
* 他の変換ツールとあわせて使い、双方のP6ファイルを比較する。

## エラーメッセージ
* (1)スキップ時間は、0〜1000の数値を入力してください（小数可）
* (2)モノラル8ビットのWAVファイルのみ対応しています ※このエラーは出ません
* (3)ファイルフォーマットが正しくありません
* (4)ファイルを読み取ることができません
* (5)読み込み途中でファイルの終わりに達しました
* (6)処理に失敗しました

## 変更履歴

* 2005/08/04 Ver. 1.0.0を公開
* 2019/04/01 ジオシティーズから引っ越し
* 2019/04/01 Ver. 1.1.0を公開
  Java対応バージョンを1.5以上に更新、16ビットPCM WAVファイル対応
* 2019/11/03 Mavenリポジトリ情報の修正、再コンパイル
* 2019/11/17 Ver. 1.1.1を公開
  WAVInputStreamのリファクタリング
* 2020/07/05 README.mdに使い方を記載
* 2021/04/29 Ver. 1.2.0を公開
  WAVファイルのフォーマットA-law, μ-lawに対応

--------
Copyright(c) はやつきかづみ（早月加積） 2017-2021

zzzszoo200@gmail.com
